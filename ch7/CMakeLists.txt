cmake_minimum_required( VERSION 2.8 )
# Cmakeæœ€ä½ç‰ˆæœ¬ï¼Œå¦‚æœåŠ å…¥â€œFATAL_ERRORâ€ï¼Œå°†å‘å‡ºè‡´å‘½é”™è¯¯ã€‚
project( vo1 )
# å£°æ˜é¡¹ç›®çš„åç§°

set( CMAKE_BUILD_TYPE "Release" )
set( CMAKE_CXX_FLAGS "-std=c++11 -O3" )
set(CMAKE_CXX_FLAGS "-std=c++14 -mfma")

# æ·»åŠ cmakeæ¨¡å—ä»¥ä½¿ç”¨ g2o
# ä½¿ç”¨è¿™ç§æ–¹æ³•ä¼šè‡ªåŠ¨åœ¨ç³»ç»Ÿçš„ cmake è·¯å¾„ï¼Œä»¥åŠå‰é¢æ–‡ä»¶è®¾ç½®çš„ cmake çš„åŒ…å«è·¯å¾„ä¸­æŸ¥æ‰¾ g2oï¼›
# å¯ä»¥é€šè¿‡LISTå‘½ä»¤å‘ CMAKE_MODULE_PATH çš„ list ä¸­æ·»åŠ æŒ‡å®šçš„è·¯å¾„ã€‚
# PROJECT_SOURCE_DIR=å…¨è·¯å¾„/src
list( APPEND CMAKE_MODULE_PATH ${PROJECT_SOURCE_DIR}/cmake_modules )

find_package( OpenCV 3.1 REQUIRED )
# find_package( OpenCV REQUIRED ) # use this if in OpenCV2 
find_package( G2O REQUIRED )
find_package( CSparse REQUIRED )
find_package( FMT  REQUIRED )

# find_package(Eigen3 REQUIRED) ä¸ºä»€ä¹ˆä¸ä½¿ç”¨è¿™ç§å¼•ç”¨æ–¹å¼ï¼ŸğŸ¤ª
# ç­”ï¼šä½¿ç”¨è¿™ç§æ–¹æ³•ä¼šè‡ªåŠ¨åœ¨ç³»ç»Ÿçš„cmakeè·¯å¾„ï¼Œä»¥åŠå‰é¢æ–‡ä»¶è®¾ç½®çš„cmakeçš„åŒ…å«è·¯å¾„ä¸­æŸ¥æ‰¾Eigenï¼›
# 

# include_directories(${EIGEN3_INCLUDE_DIR}) # ä¸ºä»€ä¹ˆä¸ç”¨è¿™ç§æ–¹å¼ï¼ŸğŸ¤ª
# ç­”ï¼šå› ä¸º

# Eigen ä½¿ç”¨ï¼šfind_package / include_dir.. ? list
# link problem?

# Eigen3 åº“çš„å¼•ç”¨æ–¹å¼ä¸æ³¨æ„ï¼šğŸ¤ª
# 1. Eigenæ˜¯çº¯ç”¨å¤´æ–‡ä»¶æ­å»ºèµ·æ¥çš„åº“ï¼Œé‡‡ç”¨æ¨¡æ¿ç¼–ç¨‹ï¼›
#      æ‰€ä»¥ï¼Œåœ¨ä½¿ç”¨çš„æ—¶å€™ï¼Œåªéœ€å¼•ç”¨å¤´æ–‡ä»¶å³å¯ï¼Œåªéœ€è¦è®¾å®šä¸€ä¸ªåŒ…å«è·¯å¾„å³å¯ï¼Œä¸éœ€è¦é“¾æ¥åº“æ–‡ä»¶ï¼ˆå› ä¸ºæ²¡æœ‰ï¼‰ã€‚
# 2. åº“æ–‡ä»¶å¯ä»¥åŒ…å«å¤´æ–‡ä»¶ï¼Œå¤´æ–‡ä»¶ä¸å¯åŒ…å«åº“æ–‡ä»¶ï¼›å¤´æ–‡ä»¶å¯è§†ï¼Œåº“æ–‡ä»¶ä¸å¯è§†ã€‚
# 3. ä¸¤ç§åº“çš„åŒºåˆ«åœ¨äºé™æ€åº“è¢«è°ƒç”¨æ—¶ç›´æ¥åŠ è½½åˆ°å†…å­˜ï¼Œè€ŒåŠ¨æ€åº“å†æ˜¯åœ¨éœ€è¦çš„æ—¶å€™åŠ è½½åˆ°å†…å­˜ï¼Œä¸ä½¿ç”¨çš„æ—¶å€™å†ä»å†…å­˜é‡Šæ”¾ã€‚
# 4. 

# åŠ å…¥æ‰€æœ‰å¤´æ–‡ä»¶
include_directories( 
    ${OpenCV_INCLUDE_DIRS} 
    ${G2O_INCLUDE_DIRS}
    ${CSPARSE_INCLUDE_DIR}
    ${FMT_INCLUDE_DIRS}    
    "/usr/include/eigen3/"
)

# æŒ‡ç¤ºCMakeåˆ›å»ºä¸€ä¸ªæ–°ç›®æ ‡ï¼šå¯æ‰§è¡Œæ–‡ä»¶ orb_cv
# è¿™ä¸ªå¯æ‰§è¡Œæ–‡ä»¶æ˜¯é€šè¿‡ç¼–è¯‘å’Œé“¾æ¥æºæ–‡ä»¶ orb_cv.cppç”Ÿæˆçš„ã€‚
# CMakeå°†ä¸ºç¼–è¯‘å™¨ä½¿ç”¨é»˜è®¤è®¾ç½®ï¼Œå¹¶è‡ªåŠ¨é€‰æ‹©ç”Ÿæˆå·¥å…·

add_executable( orb_cv orb_cv.cpp  ) 

# å°†ç›®æ ‡åº“é“¾æ¥åˆ°å¯æ‰§è¡Œç›®æ ‡
# add_library æ˜¯é™æ€åº“
# target_link_libraries å°†åŠ¨æ€åº“é“¾æ¥åˆ°ç›®æ ‡
target_link_libraries( orb_cv ${OpenCV_LIBS} )

add_executable( orb_self orb_self.cpp  )
target_link_libraries( orb_self ${OpenCV_LIBS} )

add_executable( feature_extraction feature_extraction.cpp  )
target_link_libraries( feature_extraction ${OpenCV_LIBS} )

# add_executable( pose_estimation_2d2d pose_estimation_2d2d.cpp extra.cpp ) # use this if in OpenCV2 
add_executable( pose_estimation_2d2d pose_estimation_2d2d.cpp )
target_link_libraries( pose_estimation_2d2d ${OpenCV_LIBS} )

# add_executable( triangulation triangulation.cpp extra.cpp) # use this if in opencv2 
add_executable( triangulation triangulation.cpp )
target_link_libraries( triangulation ${OpenCV_LIBS} )

add_executable( pose_estimation_3d2d pose_estimation_3d2d.cpp )
target_link_libraries( pose_estimation_3d2d 
   ${OpenCV_LIBS}
   ${CSPARSE_LIBRARY}
   g2o_core g2o_stuff g2o_types_sba g2o_csparse_extension
)

add_executable( pose_estimation_3d3d pose_estimation_3d3d.cpp )
target_link_libraries( pose_estimation_3d3d 
   ${OpenCV_LIBS}
   g2o_core g2o_stuff g2o_types_sba g2o_csparse_extension 
   ${CSPARSE_LIBRARY}
)

add_executable( pose_estimation_hand_3d2d pose_estimation_hand_3d2d.cpp )
target_link_libraries( pose_estimation_hand_3d2d 
   ${OpenCV_LIBS}
   ${THIRD_PARTY_LIBS}
   fmt::fmt
)
